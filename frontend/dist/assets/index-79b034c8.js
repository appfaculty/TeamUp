import{j as pt,u as Jt,r,B as j,C as ce,G as B,L as de,I as Je,T as o,M as U,U as Se,A as ie,a as Gt,b as Wt,c as Te,h as Vt,d as Ne,e as Ve,f as pe,g as xe,F,S as gt,i as Rt,k as Bt,l as re,m as se,n as Pt,o as Nt,p as D,q as ke,s as Ut,t as Yt,v as Qt,w as le,x as P,y as H,z as Re,D as De,R as X,E as Le,H as Ue,J as Ye,K as $t,N as Kt,O as Xt,P as Zt,Q as fe,V as bt,W as ge,X as Be,Y as en,Z as be,_ as tn,$ as nn,a0 as Dt,a1 as Ge,a2 as St,a3 as an,a4 as oe,a5 as wt,a6 as sn,a7 as rn,a8 as ln,a9 as on,aa as Lt,ab as Qe,ac as jt,ad as cn,ae as dn,af as hn,ag as vt,ah as _t,ai as At,aj as Oe,ak as We,al as Ct,am as mt,an as zt,ao as un,ap as He,aq as mn,ar as fn,as as kt,at as pn,au as gn,av as bn,aw as Sn,ax as vn,ay as Tt,az as xn,aA as yn,aB as wn,aC as Cn,aD as zn,aE as lt,aF as kn,aG as Tn,aH as En,aI as On,aJ as Mn,aK as In,aL as Rn,aM as Bn,aN as Pn,aO as Nn}from"./vendor-4c3e59ab.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))c(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const S of l.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&c(S)}).observe(document,{childList:!0,subtree:!0});function u(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function c(s){if(s.ep)return;s.ep=!0;const l=u(s);fetch(s.href,l)}})();const Z=pt.Fragment,e=pt.jsx,t=pt.jsxs,G=()=>window.appdata.config,Dn=n=>Object.keys(n).map(a=>`${a}=${n[a]}`).join("&"),Ft=(n,a)=>(n===void 0&&(n=G().wwwroot+"/local/teamup/service.php"),a=a||{},a.sesskey=G().sesskey,n+"?"+Dn(a)),ye=async(n,a)=>{const c={...{method:"GET",body:{},query:{}},...n};if(!(c.query||c.body))throw new Error("Body or query required.");const s=await fetch(Ft(a,c.query),{method:c.method||"GET",headers:{"Content-Type":"application/json"},body:c.method!=="GET"?JSON.stringify(c.body):null}),l=await s.json();if(!s.ok)throw new Error(l.message||"An error occurred.");return l},he={unsaved:0,saved:1,live:2};function $e(){const n=async()=>{var c;const u=await ye({query:{methodname:"local_teamup-check_login"}});u.error&&(((c=u.exception)==null?void 0:c.errorcode)==="requireloginerror"||u.errorcode==="requireloginerror")&&window.location.replace(G().loginUrl)},a=Jt(()=>n(),3e4);return r.useEffect(()=>(a.start(),a.stop),[]),e(Z,{children:e(j,{bg:G().headerbg,children:e(ce,{size:"xl",children:t(B,{h:54,position:"apart",children:[t(B,{spacing:"md",children:[e(de,{to:"/",children:e(Je,{width:44,src:window.appdata.config.logo})}),e(de,{to:"/",style:{textDecoration:"none"},children:e(o,{fz:"md",c:G().headerfg,children:G().toolname})})]}),t(U,{position:"bottom-end",width:200,shadow:"md",children:[e(U.Target,{children:e(Se,{children:t(B,{children:[e(ie,{size:"sm",radius:"xl",src:"/local/teamup/avatar.php?username="+G().user.un}),e(Gt,{smallerThan:"sm",styles:{display:"none"},children:e(o,{size:"sm",color:G().headerfg,children:G().user.fn+" "+G().user.ln})})]})})}),e(U.Dropdown,{children:e(U.Item,{icon:e(Wt,{size:14}),onMouseDown:()=>window.location.replace(G().logoutUrl),children:"Logout"})})]})]})})})})}function Ke(){return e(r.Fragment,{children:e("footer",{children:e(ce,{size:"xl",py:"md",children:t(o,{size:"xs",c:"dimmed",children:["v.",window.appdata.config.version]})})})})}const it={teamname:"",category:"",categoryName:"",details:"",initDescription:""},ve=Te(n=>({...it,setState:a=>n(a==-1?it:a),reset:()=>n(it)})),ot={coaches:[],assistants:[]},Me=Te(n=>({...ot,setState:a=>n(a==-1?ot:a),reset:()=>n(ot)})),ct={data:[],usernames:[],move:[]},Pe=Te(n=>({...ct,setState:a=>n(a==-1?ct:a),reset:()=>n(ct)})),ft=Te(n=>({formErrors:{},rules:{teamname:[a=>a.length?null:"Team name is required. "]},setFormErrors:a=>n({formErrors:a}),reset:()=>n({formErrors:{}})})),Et=()=>{const n=ve.getState(),a=Me.getState(),u=Pe.getState(),c=JSON.parse(JSON.stringify({...n,...a,...u}));return Vt(c)},dt={id:0,idnumber:"",creator:"",status:0,timecreated:0,timemodified:0},we=Te(n=>({...dt,setState:a=>n(a==-1?dt:a),reset:()=>n(dt)})),ht={oldhash:"",hash:"",formloaded:!1,studentsloaded:!1,haschanges:!1,reloadstulist:!1},me=Te(n=>({...ht,setState:a=>n(a==-1?ht:a),reset:()=>n(ht),reloadStudents:()=>n({reloadstulist:!0}),baselineHash:()=>{const a=Et();n({oldhash:a,hash:a})},clearHash:()=>{n({oldhash:"",hash:"",haschanges:!1})},updateHash:()=>{const a=Et();n(u=>({hash:a,haschanges:a!==u.oldhash}))},resetHash:()=>n(a=>({hash:a.oldhash,haschanges:!1})),setFormLoaded:()=>n({formloaded:!0}),setStudentsLoaded:()=>n({studentsloaded:!0})}));function Ln(){const n=ve(u=>u.teamname),a=we(u=>u.status);return e(r.Fragment,{children:e("div",{className:"page-header",children:t(ce,{size:"xl",my:"md",p:0,children:[t(Ne,{fz:"sm",mb:"sm",children:[e(de,{to:"/",children:e(o,{color:"blue",children:"Dashboard"})}),e(de,{to:location.pathname,children:e(o,{color:"gray.6",children:"Team"})})]}),e("h2",{className:"page-title",children:n||(a==he.unsaved?"New team":"Edit team")})]})})})}function jn({callback:n}){const a=f=>({value:JSON.stringify({id:f.id,name:f.name}),label:f.name}),[u,c]=r.useState([]),[s,l]=r.useState(!1),S=async f=>{if(!f.length)return;l(!0);const i=await ye({query:{methodname:"local_teamup-search_categories",text:f}});c(i.data.map(a)),l(!1)},w=f=>{n(f)};return e(r.Fragment,{children:e(Ve,{maxSelectedValues:1,placeholder:"Search categories",limit:8,rightSection:s?e(pe,{size:"xs"}):"",data:u,searchable:!0,onSearchChange:f=>S(f),onChange:w,clearSearchOnChange:!0,shadow:"lg",dropdownPosition:"bottom",styles:{value:{display:"flex"},values:{paddingTop:"0.12rem",paddingBottom:"0.12rem"}},filter:(f,i,z)=>f?!i&&z.label.toLowerCase().includes(f.toString().toLowerCase().trim()):!1})})}function _n({category:n,callback:a}){r.useEffect(()=>{z(n)},[n]);const[u,c]=r.useState({}),s=b=>({value:JSON.stringify({id:b.id,name:b.name}),type:b.type,label:b.name}),l=(b,p)=>e(Bt,{onClick:()=>d(JSON.stringify({id:b.id,name:b.name})),children:b.name},p),[S,w]=r.useState({}),[f,i]=r.useState(!1),z=async b=>{if(u[b]){w(u[b]);return}i(!0);const p=await ye({query:{methodname:"local_teamup-get_category_dir",category:b||"-1"}});p.data.children=p.data.children.filter(m=>m.type=="category"),p.data.children=p.data.children.map(s),p.data.breadcrumbs=p.data.path.map(l),w(p.data),i(!1),c(m=>({...m,[b]:p.data}))},d=b=>{z(JSON.parse(b).id),a(b)};return t(j,{pos:"relative",mih:50,children:[e(xe,{visible:f,overlayBlur:2}),S.breadcrumbs&&S.breadcrumbs.length?t(F,{justify:"start",align:"center",wrap:"wrap",gap:"sm",pt:"sm",pb:"sm",sx:{borderBottom:"0.0625rem solid #dee2e6"},children:[e(Ne,{fz:"sm",children:S.breadcrumbs}),"/ ",e(o,{tt:"capitalize",fz:"sm",fw:600,children:S.name})]}):null,e(gt,{pb:"xs",spacing:0,children:S.children&&S.children.map((b,p)=>e(Se,{onClick:()=>d(b.value),fz:"sm",py:5,sx:{borderBottom:"0.0625rem solid #dee2e6"},children:t(B,{children:[e(Rt,{size:17}),e(o,{children:b.label})]})},p))})]})}function An({opened:n,close:a,category:u,callback:c}){const[s,l]=r.useState(null),S=()=>{c(s),l(null),a()};return e(re,{opened:n,onClose:a,title:"Select a category",size:"xl",styles:{content:{overflowY:"visible !important"},header:{borderBottom:"0.0625rem solid #dee2e6"},title:{fontWeight:600}},children:t(j,{pt:"md",children:[t(se,{defaultValue:"search",orientation:"vertical",children:[t(se.List,{children:[e(se.Tab,{value:"search",icon:e(Pt,{size:"0.8rem"}),children:"Search"}),e(se.Tab,{value:"browse",icon:e(Nt,{size:"0.8rem"}),children:"Browse"})]}),e(se.Panel,{value:"search",px:"md",pb:"md",mih:150,children:e(jn,{callback:l})}),e(se.Panel,{value:"browse",px:"md",pb:"md",mih:150,children:e(_n,{category:n?u:null,callback:l})})]}),e(F,{pt:"sm",justify:"end",children:e(D,{onClick:S,disabled:!s,type:"submit",leftIcon:e(ke,{size:"1rem"}),radius:"xl",children:s?"Select "+JSON.parse(s).name:"Select category"})})]})})}function Fn(){const n=ve(),a=ve(i=>i.initDescription);we(i=>i.id);const u=ve(i=>i.setState),c=(i,z)=>{u({[i]:z})},s=Ut({extensions:[Yt,Qt],content:n.details,onBlur({editor:i,event:z}){c("details",i.getHTML())}});r.useEffect(()=>{s&&s.commands.setContent(a)},[s,a]);const l=ft(i=>i.formErrors),[S,w]=le(!1),f=i=>{const z=JSON.parse(i);c("category",z.id),c("categoryName",z.name)};return t(Z,{children:[e(P.Section,{inheritPadding:!0,pb:"sm",children:t(H,{gutter:"lg",children:[e(H.Col,{span:12,children:e(Re,{withAsterisk:!0,placeholder:"Eg. Basketball 9A",label:"Team name",value:n.teamname,error:l.teamname,onChange:i=>c("teamname",i.target.value)})}),t(H.Col,{span:12,children:[e(o,{fz:"sm",mb:"5px",weight:500,color:"#212529",children:"Category"}),e(D,{onClick:w.open,compact:!0,variant:"light",rightIcon:e(De,{size:12}),children:n.categoryName?n.categoryName:"Select"})]}),t(H.Col,{span:12,children:[e(o,{fz:"sm",mb:"5px",weight:500,color:"#212529",children:"Description"}),t(X,{editor:s,children:[t(X.Toolbar,{sticky:!0,children:[t(X.ControlsGroup,{children:[e(X.Bold,{}),e(X.Italic,{}),e(X.Strikethrough,{}),e(X.ClearFormatting,{}),e(X.Code,{})]}),t(X.ControlsGroup,{children:[e(X.H1,{}),e(X.H2,{}),e(X.H3,{}),e(X.H4,{})]}),t(X.ControlsGroup,{children:[e(X.Blockquote,{}),e(X.Hr,{}),e(X.BulletList,{}),e(X.OrderedList,{})]}),t(X.ControlsGroup,{children:[e(X.Link,{}),e(X.Unlink,{})]})]}),e(X.Content,{})]})]})]})}),e(An,{category:n.category,opened:S,close:w.close,callback:f})]})}function ae(){const[n,a]=r.useState({response:null,error:!1,loading:!1}),u=async(c={method:"GET",body:{},query:{}},s)=>{(c.query||c.body)&&(a({response:null,error:null,loading:!0}),fetch(Ft(s,c.query),{method:c.method||"GET",headers:{"Content-Type":"application/json"},body:c.method!=="GET"&&JSON.stringify(c.body)}).then(async l=>{const S=await l.json();a({response:S,error:S.error,loading:!1})}).catch(l=>{a({response:l,error:!0,loading:!1})}))};return[n.response,n.error,n.loading,u,a]}function qn({submitLoading:n,submitError:a,submitResponse:u}){let{id:c}=Le();const s=ve(),l=Me(),S=Pe(),w=we(),f=we(g=>g.setState),i=we(g=>g.status),z=me(g=>g.formloaded),d=me(g=>g.studentsloaded),b=me(g=>g.haschanges),p=me(g=>g.updateHash);r.useEffect(()=>{(!c||z&&d)&&p()},[s,l,S,w]);const[m,h]=r.useState(!1),{start:E,clear:T}=Ue(()=>h(!1),5e3);r.useEffect(()=>{!a&&u&&(h(!0),E())},[u]),r.useEffect(()=>{n&&T()},[n]);const[R,J,N,W]=ae(),C=g=>{W({method:"POST",body:{methodname:"local_teamup-publish_team",args:{id:c,publish:g}}})},I=()=>{C(1)},L=()=>{C(0)};r.useEffect(()=>{!J&&R&&(h(!0),E(),f({status:R.data.status}))},[R]);let O=null;return a&&u.exception&&(O=u.exception.message),c&&(!z||!d)?null:t(P,{withBorder:!0,radius:"sm",p:"md",mb:"lg",sx:{overflow:"visible"},bg:i==he.saved?"orange.1":i==he.live?"apprgreen.1":"",children:[e("div",{className:"page-pretitle",children:"Status"}),t(o,{size:"md",weight:500,children:[i==he.unsaved&&"Draft",i==he.saved&&"Draft",i==he.live&&"Published"]}),n||N&&e(pe,{size:"sm",m:"xs",pos:"absolute",right:5,top:5}),e(Ye,{mounted:!n&&!a&&!b&&m,transition:"fade",duration:500,timingFunction:"ease",children:g=>e(j,{style:{...g,position:"absolute",top:15,right:15},children:e(ke,{size:21,color:"teal"})})}),!n&&(O||b)&&e(o,{color:"red",size:"sm",children:O||"There are unsaved changes."}),!n&&!O&&!b&&e(o,{color:"dimmed",size:"sm",children:i==he.saved?"Publish this team to make it visible.":i==he.live?"Team is live! You may continue to make changes to information.":"Get started by entering the details for this team."}),t(B,{position:"apart",mt:"xs",children:[t(B,{spacing:"xs",children:[t(D,{type:"submit",compact:!0,radius:"xl",leftIcon:e($t,{size:14}),loading:n,children:["Save ",b?" changes":""]}),!b&&i==he.saved&&e(D,{onClick:I,compact:!0,radius:"xl",leftIcon:e(Kt,{size:14}),loading:N,children:"Publish"})]}),i==he.live&&t(U,{shadow:"lg",position:"bottom",children:[e(U.Target,{children:e(D,{compact:!0,variant:"outline",radius:"xl",rightIcon:e(Xt,{size:"1rem"}),children:"More"})}),e(U.Dropdown,{children:i==he.live&&e(U.Item,{onMouseDown:L,icon:e(Zt,{size:14}),children:"Return to planning status"})})]})]})]})}function Ot({valueprop:n,label:a,max:u}){const c=Me(m=>m[n]),s=Me(m=>m.setState),[l,S]=r.useState([]),[w,f]=r.useState(!1),i=m=>({value:JSON.stringify({un:m.un,fn:m.fn,ln:m.ln}),label:m.fn+" "+m.ln,username:m.un,image:"/local/teamup/avatar.php?username="+m.un});r.useEffect(()=>{const m=c.map(h=>i(JSON.parse(h)));S(m)},[c]);const z=async m=>{if(!m.length)return;f(!0);const E=(await ye({query:{methodname:"local_teamup-search_staff",text:m}})).data.map(i),T=new Set(l.map(J=>J.username)),R=[...l,...E.filter(J=>!T.has(J.username))];S(R),f(!1)},d=m=>{s({[n]:m})},b=r.forwardRef(({label:m,username:h,image:E,...T},R)=>e("div",{ref:R,...T,children:t(B,{noWrap:!0,spacing:"xs",children:[e(ie,{alt:m,size:24,mr:5,src:E,radius:"xl",children:e(fe,{size:14})}),t(o,{children:[m," (",h,")"]})]})}));function p({value:m,label:h,onRemove:E,classNames:T,...R}){return e("div",{...R,children:e(ge,{variant:"filled",p:0,color:"gray.2",size:"lg",radius:"xl",leftSection:e(ie,{alt:h,size:24,mr:5,src:R.image,radius:"xl",children:e(fe,{size:14})}),children:t(F,{gap:4,children:[e(o,{sx:{textTransform:"none",fontWeight:"400",color:"#000"},children:h}),e(Be,{onMouseDown:E,variant:"transparent",size:22,iconSize:14,tabIndex:-1})]})})})}return e(r.Fragment,{children:e(Ve,{icon:u==1?e(fe,{size:18}):e(bt,{size:18}),maxSelectedValues:u,label:a,placeholder:"Search staff",itemComponent:b,valueComponent:p,limit:8,rightSection:w?e(pe,{size:"xs"}):"",data:l,searchable:!0,onSearchChange:m=>z(m),onChange:d,value:c,clearSearchOnChange:!0,shadow:"lg",styles:{value:{display:"flex"},values:{paddingTop:"0.12rem",paddingBottom:"0.12rem"}},filter:(m,h,E)=>m?!h&&E.label.toLowerCase().includes(m.toString().toLowerCase().trim()):!1})})}function Hn(){return e(P.Section,{inheritPadding:!0,py:"sm",children:t(H,{gutter:"xl",children:[e(H.Col,{span:12,children:e(Ot,{max:null,valueprop:"coaches",label:"Coaches"})}),e(H.Col,{span:12,children:e(Ot,{max:null,valueprop:"assistants",label:"Assistants"})})]})})}const Jn=()=>({accessorFn:n=>t(F,{wrap:"wrap",gap:4,align:"center",children:[e(ge,{variant:"filled",pl:0,size:"lg",color:"gray.2",radius:"xl",leftSection:e(ie,{alt:n.fn+" "+n.ln,size:24,mr:5,src:"/local/teamup/avatar.php?username="+n.un,radius:"xl",children:e(fe,{size:14})}),children:e(o,{sx:{textTransform:"none",fontWeight:"400",color:"#000"},children:n.ln+", "+n.fn})},n.un),n.moveToTeamId&&t(en,{py:0,px:5,color:"yellow",radius:"xs",children:["Save changes to move into ",n.moveToTeamName]})]}),id:"student",header:"Student"});function Gn({students:n,setStudents:a}){const u=d=>({value:JSON.stringify({un:d.un,fn:d.fn,ln:d.ln}),label:d.fn+" "+d.ln,username:d.un,image:"/local/teamup/avatar.php?username="+d.un});r.useEffect(()=>{const d=n.map(b=>u(JSON.parse(b)));s(d)},[n]);const[c,s]=r.useState([]),[l,S]=r.useState(!1),w=async d=>{if(!d.length)return;S(!0);const p=(await ye({query:{methodname:"local_teamup-search_students",text:d}})).data.map(u);s(p),S(!1)},f=d=>{a(d)},i=r.forwardRef(({label:d,username:b,image:p,...m},h)=>e("div",{ref:h,...m,children:t(B,{noWrap:!0,spacing:"xs",children:[e(ie,{alt:d,size:24,mr:5,src:p,radius:"xl",children:e(fe,{size:14})}),t(o,{children:[d," (",b,")"]})]})}));function z({value:d,label:b,onRemove:p,classNames:m,...h}){return e("div",{...h,children:e(ge,{variant:"filled",p:0,color:"gray.2",size:"lg",radius:"xl",leftSection:e(ie,{alt:b,size:24,mr:5,src:h.image,radius:"xl",children:e(fe,{size:14})}),children:t(F,{gap:4,children:[e(o,{sx:{textTransform:"none",fontWeight:"400",color:"#000"},children:b}),e(Be,{onMouseDown:p,variant:"transparent",size:22,iconSize:14,tabIndex:-1})]})})})}return e(r.Fragment,{children:e(Ve,{icon:e(bt,{size:18}),placeholder:"Search students",itemComponent:i,valueComponent:z,limit:8,rightSection:l?e(pe,{size:"xs"}):"",data:c,searchable:!0,onSearchChange:d=>w(d),onChange:f,value:n,clearSearchOnChange:!0,shadow:"lg",dropdownPosition:"bottom",styles:{value:{display:"flex"},values:{paddingTop:"0.12rem",paddingBottom:"0.12rem"}},filter:(d,b,p)=>d?!b&&p.label.toLowerCase().includes(d.toString().toLowerCase().trim()):!1})})}function je({category:n,callback:a,showCheckbox:u=!0}){const[c,s]=r.useState({});r.useEffect(()=>{p(n)},[n]);const l=h=>({...h,value:JSON.stringify({id:h.id,name:h.name}),type:h.type,label:h.name}),S=(h,E)=>e(Bt,{onClick:()=>m(JSON.stringify({id:h.id,name:h.name}),"category"),children:h.name},E),[w,f]=r.useState({}),[i,z]=r.useState(null),[d,b]=r.useState(!1),p=async h=>{if(c[h]){f(c[h]);return}b(!0);const E=await ye({query:{methodname:"local_teamup-get_category_dir",category:h||"-1"}});E.data.children=E.data.children.map(l),E.data.breadcrumbs=E.data.path.map(S),f(E.data),b(!1),s(T=>({...T,[h]:E.data}))},m=(h,E)=>{console.log("item clicked: "+h),E=="category"?(z(null),p(JSON.parse(h).id)):(z(JSON.parse(h).id),a(h))};return t(j,{pos:"relative",mih:50,children:[e(xe,{loaderProps:{size:"sm"},visible:d,overlayBlur:2}),w.breadcrumbs&&w.breadcrumbs.length?t(F,{justify:"start",align:"center",wrap:"wrap",gap:"sm",py:"sm",sx:{borderBottom:w.children.length?"0.0625rem solid #dee2e6":"0 none"},children:[e(Ne,{fz:"sm",children:w.breadcrumbs}),"/ ",e(o,{tt:"capitalize",fz:"sm",fw:600,children:w.name})]}):null,e(gt,{py:5,spacing:0,children:w.children&&w.children.map((h,E)=>e(Se,{onClick:()=>m(h.value,h.type),fz:"sm",py:"xs",sx:{borderBottom:E+1===w.children.length?"0 none":"0.0625rem solid #dee2e6"},children:t(B,{children:[h.type=="category"?e(Rt,{size:17}):u?e(be,{size:15,checked:i==h.id,onChange:()=>{}}):"",e(o,{color:h.type=="team"?"tablrblue":null,children:h.label})]})},E))})]})}function Wn({opened:n,close:a,insert:u}){const[c,s]=r.useState([]),[l,S]=r.useState(0),w=async()=>{let i=[];l.length?i=(await ye({query:{methodname:"local_teamup-get_team_students",id:JSON.parse(l).id}})).data:i=c.map(z=>JSON.parse(z)),u(i),s([]),a()},f=i=>{s([]),S(i)};return e(re,{opened:n,onClose:a,title:"Add students",size:"xl",styles:{content:{overflowY:"visible !important"},header:{borderBottom:"0.0625rem solid #dee2e6"},title:{fontWeight:600}},children:t(j,{pt:"md",children:[t(se,{defaultValue:"students",orientation:"vertical",children:[t(se.List,{children:[e(se.Tab,{value:"students",icon:e(fe,{size:"0.8rem"}),children:"Individuals"}),e(se.Tab,{value:"teams",icon:e(tn,{size:"0.8rem"}),children:"Teams"})]}),e(se.Panel,{value:"students",px:"md",pb:"md",mih:150,children:e(Gn,{students:c,setStudents:s})}),e(se.Panel,{value:"teams",px:"md",pb:"md",mih:150,children:e(je,{category:-1,callback:f,showCheckbox:!0})})]}),e(F,{pt:"sm",justify:"end",children:e(D,{onClick:w,disabled:!c.length&&!l,type:"submit",leftIcon:e(nn,{size:"1rem"}),radius:"xl",children:"Insert students"})})]})})}function Vn({callback:n}){const a=f=>({value:JSON.stringify({id:f.id,name:f.name}),label:f.name}),[u,c]=r.useState([]),[s,l]=r.useState(!1),S=async f=>{if(!f.length)return;l(!0);const i=await ye({query:{methodname:"local_teamup-search_teams",text:f}});c(i.data.map(a)),l(!1)},w=f=>{n(f)};return e(r.Fragment,{children:e(Ve,{maxSelectedValues:1,placeholder:"Search teams",limit:8,rightSection:s?e(pe,{size:"xs"}):"",data:u,searchable:!0,onSearchChange:f=>S(f),onChange:w,clearSearchOnChange:!0,shadow:"lg",dropdownPosition:"bottom",styles:{value:{display:"flex"},values:{paddingTop:"0.12rem",paddingBottom:"0.12rem"}},filter:(f,i,z)=>f?!i&&z.label.toLowerCase().includes(f.toString().toLowerCase().trim()):!1})})}function Un({opened:n,close:a,category:u,callback:c}){const[s,l]=r.useState(null),S=()=>{c(s),l(null),a()};return e(re,{opened:n,onClose:a,title:"Select a team",size:"xl",styles:{content:{overflowY:"visible !important"},header:{borderBottom:"0.0625rem solid #dee2e6"},title:{fontWeight:600}},children:t(j,{pt:"md",children:[t(se,{defaultValue:"search",orientation:"vertical",children:[t(se.List,{children:[e(se.Tab,{value:"search",icon:e(Pt,{size:"0.8rem"}),children:"Search"}),e(se.Tab,{value:"browse",icon:e(Nt,{size:"0.8rem"}),children:"Browse"})]}),e(se.Panel,{value:"search",px:"md",pb:"md",mih:150,children:e(Vn,{callback:l})}),e(se.Panel,{value:"browse",px:"md",pb:"md",mih:150,children:e(je,{category:n?u:null,callback:l})})]}),e(F,{pt:"sm",justify:"end",children:e(D,{onClick:S,disabled:!s,type:"submit",leftIcon:e(ke,{size:"1rem"}),radius:"xl",children:"Move to this team"})})]})})}function qt({opened:n,close:a,students:u,teamid:c}){const s={teams:[],notify:["students"],subject:"",message:""},[l,S]=r.useState(s),[w,f]=r.useState([]),[i,z]=r.useState(u),[d,b]=r.useState([]),[p,m]=r.useState(!1),[h,E,T,R]=ae(),{start:J,clear:N}=Ue(()=>a(),3e3),W={subject:[y=>y.length?null:"Title is required. "],message:[y=>y.length?null:"Message is required. "],teams:[y=>!c&&!y.length?"Teams are required. ":null]};r.useEffect(()=>{n&&(S(s),m(!1))},[n]),r.useEffect(()=>{z(u)},[u]);const C=()=>{let y={hasErrors:!1};for(let k in W)for(let[Y,Q]of W[k].entries()){let $=Q(l[k]);if($){y.hasErrors=!0;let V=[];Object.hasOwn(y,k)&&(V=y[k]),V.push($),y={...y,[k]:V}}}return y},I=()=>{b([]);const y=C();if(y.hasErrors){b(y);return}let k=JSON.parse(JSON.stringify({...l}));c?(k.students=i.map(Y=>Y.un),k.teams=[c]):(k.students=[],k.teams=k.teams.map(Y=>Y.id)),console.log(k),R({method:"POST",body:{methodname:"local_teamup-submit_message",args:k}})};r.useEffect(()=>{if(!E&&h&&(m(!0),J()),E){let y="There was an error submitting. "+h.exception!==void 0?h.exception.message:"";b({hasErrors:!1,submit:y})}},[h]);const L=e(Ye,{mounted:p,transition:"fade",duration:500,timingFunction:"ease",children:y=>t(F,{mb:"xl",direction:"column",align:"center",style:{...y},children:[e(ke,{size:45,color:"green"}),e(o,{fz:"md",children:"Success! Your message has been posted and notifications are being sent."})]})}),O=y=>{z(k=>k.filter(function(Y){return Y.un!==y}))},g=y=>e(ge,{variant:"filled",p:0,color:"gray.2",size:"lg",radius:"xl",leftSection:e(ie,{alt:y.fn+" "+y.ln,size:24,mr:5,src:"/local/teamup/avatar.php?username="+y.un,radius:"xl",children:e(fe,{size:14})}),children:t(F,{gap:4,children:[e(o,{sx:{textTransform:"none",fontWeight:"400",color:"#000"},children:y.fn+" "+y.ln}),e(Be,{onMouseDown:()=>O(y.un),variant:"transparent",size:22,iconSize:14,tabIndex:-1})]})},y.un),q=y=>{const k=JSON.parse(y);l.teams.some(Q=>k.id==Q.id)||S(Q=>({...Q,teams:[...Q.teams,k]}))},A=y=>{S(k=>({...k,teams:k.teams.filter(Y=>Y.id!=y)}))};r.useEffect(()=>{f(l.teams.map((y,k)=>e(ge,{pr:0,mr:"xs",mb:"xs",variant:"filled",color:"gray.2",size:"lg",radius:"xl",children:t(F,{gap:4,children:[e(o,{sx:{textTransform:"none",fontWeight:"400",color:"#000"},children:y.name}),e(Be,{onMouseDown:()=>A(y.id),variant:"transparent",size:22,iconSize:14,tabIndex:-1})]})},k)))},[l.teams]);const te=t(j,{children:[c?t(j,{mb:"md",children:[e(o,{fz:"sm",mb:5,weight:500,color:"#212529",children:"Students"}),e(Dt,{h:i.length>12?100:"auto",type:"auto",children:e(B,{spacing:"xs",children:i.map(y=>g(y))})})]}):t(j,{mb:"md",children:[e(o,{fz:"sm",mb:5,weight:500,color:"#212529",children:"Select teams"}),e(F,{children:w}),d.teams?e(o,{mb:5,fz:12,c:"red",sx:{wordBreak:"break-all"},children:d.teams}):"",e(Ge,{radius:"sm",px:"md",sx:{border:"0.0625rem solid #dee2e6"},children:e(je,{category:n?-1:!1,callback:q,showCheckbox:!1})})]}),e(Re,{label:"Subject",error:d.subject,value:l.subject,onChange:y=>S(k=>({...k,subject:y.target.value})),mb:"md"}),e(St,{label:"Message",autosize:!0,minRows:4,maxRows:10,error:d.message,value:l.message,onChange:y=>S(k=>({...k,message:y.target.value})),mb:"md"}),t(j,{mb:"md",children:[e(o,{fz:"sm",mb:5,fw:500,children:"Recipients"}),e(be.Group,{value:l.notify,onChange:y=>S(k=>({...k,notify:y})),children:t(F,{mt:"xs",gap:"xs",direction:"column",children:[e(be,{value:"students",label:"Students"}),e(be,{value:"parents",label:"Parents"}),e(be,{value:"teamstaff",label:"Coaches/Assistants"})]})})]}),d.hasErrors?e(o,{mt:"xs",c:"red",sx:{wordBreak:"break-all"},children:"Correct form errors and try again."}):"",d.submit?e(o,{mt:"xs",c:"red",sx:{wordBreak:"break-all"},children:d.submit}):"",e(F,{pt:"sm",justify:"end",children:e(D,{leftIcon:e(an,{size:"1rem"}),onClick:I,loading:T,disabled:d.length,type:"submit",radius:"xl",children:"Submit"})})]});return e(re,{opened:n,onClose:a,title:"Send message",size:"xl",styles:{header:{borderBottom:"0.0625rem solid #dee2e6"},title:{fontWeight:600}},children:e(j,{pt:"md",children:p?L:te})})}function Yn({reload:n}){var L,O;let{id:a}=Le();const u=ve(g=>g.category),c=we(g=>g.status),s=Pe(),l=me(g=>g.setStudentsLoaded),S=me(g=>g.baselineHash),w=me(g=>g.haschanges),[f,i]=le(!1),[z,d]=le(!1),[b,p]=le(!1),[m,h,E,T]=ae();r.useEffect(()=>{if(a){if(!n&&m&&!h)return;T({query:{methodname:"local_teamup-get_team_students",id:a}})}},[n]),r.useEffect(()=>{if(m&&!h){s.setState({data:m.data,move:[]});const g=m.data.map(q=>q.un);s.setState({usernames:g}),S(),l()}},[m]);const R=g=>{const q=g.filter(y=>!s.usernames.includes(y.un)),A=q.map(y=>y.un);s.setState({usernames:s.usernames.concat(A)});const te=q.map(y=>({...y,attributes:[]}));s.setState({data:s.data.concat(te)})},J=()=>{const g=Object.keys(C),q=s.usernames.filter(y=>!g.includes(y));s.setState({usernames:q});const A=s.data.filter(y=>!g.includes(y.un));s.setState({data:A});const te=s.move.filter(y=>!g.includes(y.username));s.setState({move:te}),I({})},N=g=>{const q=Object.keys(C),A=JSON.parse(g),te=s.data.map(k=>q.includes(k.un)?{...k,moveToTeamId:A.id,moveToTeamName:A.name}:k);s.setState({data:te}),I({});const y=te.filter(k=>!!k.moveToTeamId);s.setState({move:y.map(k=>({username:k.un,teamid:k.moveToTeamId}))})},W=r.useMemo(()=>[Jn()],[]),[C,I]=r.useState({});return t(Z,{children:[t(P,{withBorder:!0,radius:"sm",mb:"lg",children:[e(P.Section,{inheritPadding:!0,py:"sm",children:t(B,{position:"apart",children:[e(o,{size:"md",weight:500,children:"Students"}),t(o,{color:"dimmed",children:[" ",Object.keys(C).length?Object.keys(C).length+" selected":((L=s.data)==null?void 0:L.length)+" students"," "]})]})}),E?e(P.Section,{py:"lg",sx:{borderTop:"0.0625rem solid #dee2e6"},children:e(oe,{children:e(pe,{size:"sm"})})}):((O=s.data)==null?void 0:O.length)==0?e(P.Section,{inheritPadding:!0,py:"sm",sx:{borderTop:"0.0625rem solid #dee2e6"},children:e(D,{onClick:i.open,variant:"filled",radius:"xl",leftIcon:e(wt,{size:14}),children:"Add students"})}):t(Z,{children:[e(P.Section,{sx:{borderTop:"0.0625rem solid #dee2e6"},children:e(sn,{columns:W,data:s.data,enableRowSelection:!0,mantineTableBodyRowProps:({row:g})=>({onClick:g.getToggleSelectedHandler(),sx:{cursor:"pointer"}}),getRowId:g=>g.un,onRowSelectionChange:I,state:{rowSelection:C},initialState:{density:"xs"},displayColumnDefOptions:{"mrt-row-select":{size:30}},enableColumnActions:!1,enableColumnFilters:!1,enablePagination:!1,enableSorting:!1,enableBottomToolbar:!1,enableTopToolbar:!1,mantinePaperProps:{shadow:!1,withBorder:!1},mantineTableProps:{highlightOnHover:!1,withColumnBorders:!1,horizontalSpacing:"md",verticalSpacing:"xs",className:"student-list-table"},mantineTableHeadCellProps:{sx:g=>({backgroundColor:g.colors.gray[0],textTransform:"none",letterSpacing:0,fontWeight:"500!important",fontSize:"0.875rem",color:"#000!important"}),className:"student-list-table-headcell"},mantineSelectAllCheckboxProps:{size:"xs"},mantineSelectCheckboxProps:{size:"xs"}})}),e(P.Section,{inheritPadding:!0,pt:"md",children:t(B,{position:"apart",children:[t(F,{gap:"sm",children:[e(D,{onClick:i.open,variant:"light",compact:!0,radius:"xl",leftIcon:e(wt,{size:14}),children:"Add students"}),Object.keys(C).length>0&&t(Z,{children:[e(D,{onClick:J,variant:"light",compact:!0,radius:"xl",leftIcon:e(rn,{size:14}),children:"Remove"}),e(D,{onClick:d.open,variant:"light",compact:!0,radius:"xl",leftIcon:e(ln,{size:14}),children:"Change team"})]})]}),c==he.saved||c==he.live&&e(on.Floating,{disabled:!w,label:"You must save changes before you may send messages.",children:e(D,{variant:"filled",color:w?"gray.4":null,onClick:()=>w?null:p.open(),compact:!0,radius:"xl",leftIcon:e(Lt,{size:14}),children:"Send a message"})})]})})]})]}),e(Wn,{opened:f,close:i.close,insert:R}),e(Un,{category:u,opened:z,close:d.close,callback:N}),e(qt,{students:Object.keys(C).length?s.data.filter(g=>Object.keys(C).includes(g.un)):s.data,teamid:a,opened:b,close:p.close})]})}function Mt(){let{id:n}=Le();const a=ve(g=>g.setState),u=Me(g=>g.setState),c=Pe(g=>g.setState),s=we(g=>g.setState),l=me(g=>g.setState),S=me(g=>g.setFormLoaded),w=me(g=>g.baselineHash),f=me(g=>g.clearHash),i=me(g=>g.resetHash),z=ft(g=>g.rules),d=ft(g=>g.setFormErrors),[b,p,m,h,E]=ae(),[T,R,J,N,W]=ae(),[C,I]=r.useState(!1);r.useEffect(()=>{document.title="Manage Team",n?N({query:{methodname:"local_teamup-get_team",id:n}}):(a(-1),u(-1),c(-1),s(-1),l(-1),f())},[n]),r.useEffect(()=>{if(T&&!R){a({idnumber:T.data.idnumber,teamname:T.data.teamname,category:T.data.category,categoryName:T.data.categoryname,initDescription:T.data.details,details:T.data.details});const g=T.data.coaches?JSON.parse(T.data.coaches).map(A=>JSON.stringify({un:A.un,fn:A.fn,ln:A.ln})):[],q=T.data.assistants?JSON.parse(T.data.assistants).map(A=>JSON.stringify({un:A.un,fn:A.fn,ln:A.ln})):[];u({coaches:g,assistants:q}),s({id:T.data.id,creator:T.data.creator,status:T.data.status,timecreated:T.data.timecreated,timemodified:T.data.timemodified}),S()}},[T]);const L=Qe();r.useEffect(()=>{if(!p&&b){if(!Object.hasOwn(b.data,"id")){i(),E({response:{exception:{message:"Something went wrong! Please reload and try again."}},error:!0,loading:!1});return}n?(s({status:b.data.status}),console.log("Triggering student reload."),I(!0)):L("/team/"+b.data.id,{replace:!0})}p&&i()},[b]);const O=g=>{g.preventDefault(),I(!1);const q=ve.getState(),A=Me.getState(),te=Pe.getState(),y=we.getState();let k=JSON.parse(JSON.stringify({...y,...q,...A}));k.studentlist=te.usernames,k.studentlistmove=te.move;let Y=!1,Q={};for(let $ in z)for(let[V,ue]of z[$].entries()){let ee=ue(k[$]);if(ee){Y=!0;let Ce=[];Object.hasOwn(Q,$)&&(Ce=Q[$]),Ce.push(ee),Q={...Q,[$]:Ce}}}if(d(Q),Y){E({response:{exception:{message:"Form has validation errors. Fix them and try again."}},error:!0,loading:!1});return}k.coaches=k.coaches.map($=>JSON.parse($)),k.assistants=k.assistants.map($=>JSON.parse($)),w(),h({method:"POST",body:{methodname:"local_teamup-post_team",args:k}})};return t(r.Fragment,{children:[e($e,{}),e("div",{className:"page-wrapper",style:{minHeight:"calc(100vh - 154px)"},children:n&&!T?e(oe,{h:200,mx:"auto",children:e(pe,{variant:"dots"})}):n&&R?e(ce,{size:"xl",children:e(oe,{h:300,children:e(o,{fw:600,fz:"lg",children:"Failed to load team..."})})}):t(Z,{children:[e(ce,{size:"xl",children:e(Ln,{})}),e(ce,{size:"xl",my:"md",children:e("form",{noValidate:!0,onSubmit:O,children:t(H,{grow:!0,children:[e(H.Col,{xs:12,lg:9,children:t(j,{children:[t(P,{withBorder:!0,radius:"sm",pb:"xs",mb:"lg",sx:{overflow:"visible"},children:[e(Fn,{}),e(Hn,{})]}),e(Yn,{reload:C})]})}),e(H.Col,{xs:12,lg:3,children:e(qn,{submitLoading:m,submitError:p,submitResponse:b})})]})})})]})}),e(Ke,{})]})}function Qn({opened:n,team:a,close:u}){var c;return e(re,{opened:n,onClose:u,title:a.teamname,size:"xl",styles:{header:{borderBottom:"0.0625rem solid #dee2e6"},title:{fontWeight:600}},children:t(j,{pt:"sm",pb:"md",children:[e(o,{mb:5,fz:"sm",fw:600,children:"Coaches"}),e(j,{children:a.coaches&&a.coaches.map((s,l)=>t(B,{spacing:"xs",children:[e(ie,{size:"sm",radius:"xl",src:"/local/teamup/avatar.php?username="+s.un},l),t(o,{fz:"sm",children:[s.fn," ",s.ln]})]}))}),!!((c=a==null?void 0:a.details)!=null&&c.length)&&t(Z,{children:[e(o,{mb:5,mt:"md",fz:"sm",fw:600,children:"Details"}),e(o,{fz:"sm",children:a.details})]})]})})}function $n(){const[n,a,u,c]=ae(),[s,l]=r.useState([]),[S,w]=le(!1),[f,i]=r.useState({});r.useEffect(()=>{c({query:{methodname:"local_teamup-get_user_teams"}})},[]),r.useEffect(()=>{n&&!a&&l(n.data)},[n]);const z=d=>{i(d),w.open()};return t(P,{withBorder:!0,radius:"sm",pb:"md",children:[e(P.Section,{withBorder:!0,p:"md",children:e(o,{size:"md",weight:500,children:"Your Teams"})}),e(P.Section,{pb:5,children:t(j,{pos:"relative",mih:40,children:[e(xe,{loaderProps:{size:"sm"},visible:u}),!s.length&&n&&e(o,{c:"dimmed",px:"md",py:"sm",fz:"sm",children:"You are not in any teams"}),s.map((d,b)=>t(j,{sx:{borderBottom:b+1===s.length?"0 none":"0.0625rem solid #dee2e6"},children:[d.role=="parent"?e("div",{children:t(B,{spacing:"xs",px:"md",py:5,bg:"gray.1",children:[e(ie,{size:"sm",radius:"xl",src:"/local/teamup/avatar.php?username="+d.child.un}),t(o,{fz:"sm",children:[d.child.fn," ",d.child.ln]})]})}):null,e(jt,{horizontalSpacing:"lg",children:e("tbody",{children:d.teams.map((p,m)=>e("tr",{children:e("td",{children:d.role=="teamstaff"?e(de,{to:"/team/"+p.id,children:e(o,{fz:"sm",color:"tablrblue",children:p.teamname})}):t(Se,{onClick:()=>z(p),children:[e(o,{fz:"sm",color:"tablrblue",children:p.teamname})," "]})})},m))})})]},b)),!!s.length&&e(Qn,{opened:S,team:f,close:w.close})]})})]})}function Kn({value:n}){const a=r.useRef(),u=()=>{let l=a.current.querySelector("canvas").toDataURL("image/png"),S=document.createElement("a");S.href=l,S.download="QRCode.png",document.body.appendChild(S),S.click(),document.body.removeChild(S)},c=e(cn,{id:"qrCode",value:n,size:265,bgColor:"#ffffff",fgColor:"#000000",level:"H",includeMargin:!0});return t(P,{withBorder:!0,radius:"sm",pb:"xl",children:[e(P.Section,{withBorder:!0,p:"md",children:e(o,{size:"md",weight:500,children:"Your QR Code"})}),t(P.Section,{children:[e(oe,{children:e(j,{ref:a,children:c})}),e(oe,{pb:"sm",children:e(D,{onClick:u,radius:"xl",children:"Download QR Code"})})]})]})}function Xn(){const[n,a,u,c]=ae(),[s,l]=r.useState([]),[S,w]=r.useState(!0),[f,i]=r.useState(0),[z,d]=le(!1);r.useEffect(()=>{f||i(1)},[]),r.useEffect(()=>{f&&S&&c({query:{methodname:"local_teamup-get_messages",page:f}})},[f]),r.useEffect(()=>{if(n&&!a){const p=[...s,...n.data.messages];l(p),w(n.data.hasNextPage)}},[n]);const b=(p,m)=>t(j,{className:"message",p:"sm",pr:"md",sx:{borderBottom:"0.0625rem solid #dee2e6"},children:[t(B,{position:"apart",align:"start",children:[t(B,{children:[e(ie,{size:"2rem",src:"/local/teamup/avatar.php?username="+p.un,alt:p.fn+" "+p.ln,radius:"xl"}),t("div",{children:[e(o,{size:"sm",children:p.fn+" "+p.ln}),e(o,{size:"xs",color:"dimmed",children:p.postedAt})]})]}),e(de,{to:"/messages/"+p.id,children:e(o,{c:"blue",children:e(dn,{size:"1rem"})})})]}),t(o,{size:"sm",children:[e(o,{fw:500,children:p.subject}),e("div",{dangerouslySetInnerHTML:{__html:p.body}})]})]},m);return t(Z,{children:[t(P,{withBorder:!0,radius:"sm",children:[e(P.Section,{p:"md",withBorder:!0,children:t(B,{position:"apart",children:[e(o,{size:"md",weight:500,children:"Messages"}),G().roles.includes("manager")&&e(D,{onClick:d.open,radius:"lg",compact:!0,variant:"light",leftIcon:e(De,{size:12}),children:"Post"})]})}),e(P.Section,{children:t(j,{pos:"relative",mih:40,children:[e(xe,{loaderProps:{size:"sm"},visible:u&&f==1}),s.length?t(Dt,{h:s.length<4?"auto":400,type:"auto",children:[s.map((p,m)=>b(p,m)),S&&e(oe,{p:"sm",children:e(D,{variant:"light",loading:u,onClick:()=>i(p=>p+1),compact:!0,px:"sm",radius:"xl",children:"Load more"})})]}):null,!s.length&&n&&e(o,{c:"dimmed",px:"md",py:"sm",fz:"sm",children:"You have no messages"})]})})]}),e(qt,{students:[],teamid:0,opened:z,close:d.close})]})}function Zn(){const n=Qe(),a=u=>{const c=JSON.parse(u);c.id&&n("/team/"+c.id)};return t(P,{withBorder:!0,radius:"sm",children:[e(P.Section,{p:"md",children:t(B,{position:"apart",children:[e(o,{size:"md",weight:500,children:"Manage Teams"}),e(de,{to:"/team",children:e(D,{radius:"lg",compact:!0,variant:"light",leftIcon:e(De,{size:12}),children:"New team"})})]})}),e(P.Section,{withBorder:!0,inheritPadding:!0,py:0,children:e(je,{category:-1,callback:a,showCheckbox:!1})})]})}const ea="/local/teamup/frontend/dist/assets/icon-coach-5f381700.png",ta="/local/teamup/frontend/dist/assets/icon-player-c230bfdc.png",na="/local/teamup/frontend/dist/assets/icon-parent-4f15472c.png",aa="/local/teamup/frontend/dist/assets/icon-schedule-ed01df88.png";function xt({opened:n,eventData:a,showOptions:u,close:c,viewRole:s,onCancel:l,onDelete:S,isCancelModalOpen:w}){var m;const[f,i,z,d]=ae(),[b,p]=r.useState(!1);return r.useEffect(()=>{a&&(s=="browse"||s===void 0)&&(p(!1),d({query:{methodname:"local_teamup-is_event_teamstaff",id:a.id}}))},[a,s]),r.useEffect(()=>{f&&!i&&f.data.allowed&&p(!0)},[f]),t(re.Root,{opened:n&&!w,onClose:()=>{c()},size:"xl",sx:{overflow:"visible"},children:[e(re.Overlay,{}),e(re.Content,{pos:"relative",mih:200,sx:{overflow:"visible"},children:a&&t(Z,{children:[t(re.Header,{pb:0,sx:{borderTopLeftRadius:"0.25rem",borderTopRightRadius:"0.25rem"},children:[e(re.Title,{children:t(B,{spacing:3,children:[e(o,{fz:"xl",fw:600,children:a.title}),e(o,{fz:"xl",fw:600,children:a.cancelled?"(Cancelled)":""})]})}),e(re.CloseButton,{mt:-15})]}),e(re.Body,{children:t(P,{sx:{overflow:"visible"},children:[e(P.Section,{pb:5,children:t(B,{position:"apart",children:[t(B,{my:3,position:"left",children:[e(o,{fz:"sm",td:a.cancelled?"line-through":"",children:a.startReadable}),"-",e(o,{fz:"sm",td:a.cancelled?"line-through":"",children:a.endReadable})]}),u?e(B,{spacing:"xs",children:!a.cancelled&&(b||s=="teamstaff"||G().roles.includes("manager"))?t(Z,{children:[e(de,{to:"/attendance/"+a.id,children:e(D,{radius:"lg",compact:!0,variant:"filled",leftIcon:e(hn,{size:12}),children:"Attendance"})}),t(U,{shadow:"md",width:200,position:"bottom",children:[e(U.Target,{children:e(D,{compact:!0,variant:"light",radius:"xl",rightIcon:e(vt,{size:16}),children:"Manage"})}),t(U.Dropdown,{children:[!a.cancelled&&e(U.Item,{icon:e(_t,{size:14}),onMouseDown:l,children:"Cancel"}),e(U.Item,{color:"red",icon:e(At,{size:14}),onMouseDown:S,children:"Delete"})]})]})]}):null}):""]})}),t(P.Section,{withBorder:!0,pt:"xs",children:[t(B,{position:"apart",mb:5,spacing:5,children:[e(o,{fz:"sm",children:a.location}),e(B,{spacing:"xs",children:(m=a==null?void 0:a.teams)==null?void 0:m.map((h,E)=>b||s=="teamstaff"||G().roles.includes("manager")?e(Z,{children:e(de,{to:"/team/"+h.teamid,children:e(ge,{variant:"filled",color:"gray.2",size:"lg",children:e(o,{tt:"none",fw:400,c:"#000",td:h.cancelled=="1"?"line-through":"",children:h.teamname})},E)})}):e(ge,{variant:"filled",color:"gray.2",size:"lg",children:e(o,{tt:"none",fw:400,c:"#000",td:h.cancelled=="1"?"line-through":"",children:h.teamname})},E))})]}),e(o,{fz:"md",children:a.details})]})]})})]})})]})}function yt({deleteOrCancel:n,eventid:a,opened:u,close:c,submitted:s}){const[l,S,w,f,i]=ae(),[z,d,b,p,m]=ae(),[h,E]=r.useState({}),[T,R]=r.useState("one"),[J,N]=r.useState("all"),[W,C]=r.useState({}),[I,L]=r.useState([]),[O,g]=r.useState(""),{start:q,clear:A}=Ue(()=>s(),3e3),te=n==1?"cancel":"delete";r.useEffect(()=>{u&&!h.title&&(Y(),f({query:{methodname:"local_teamup-get_event_series_info",id:a}}))},[u]),r.useEffect(()=>{l&&!S&&E(l.data)},[l]);const y=()=>{if(J=="select"&&Object.keys(W).length===0){g("You must select at least one team.");return}const V={eventid:a,action:te,series:T,teams:J,teamsChecked:Object.keys(W),notifyChecked:I};g(""),p({method:"POST",body:{methodname:"local_teamup-cancel_event",args:V}})};r.useEffect(()=>{!d&&z&&q(),d&&g("There was an error submitting. "+z.exception.message)},[z]);const k=()=>{!d&&z?(A(),s()):c()},Y=()=>{E({}),R("one"),N("all"),C({}),L([]),m({response:null,error:!1,loading:!1}),i({response:null,error:!1,loading:!1})},Q=()=>e(Ye,{mounted:z&&!d,transition:"fade",duration:500,timingFunction:"ease",children:V=>t(F,{mb:"xl",direction:"column",align:"center",style:{...V},children:[e(ke,{size:45,color:"green"}),e(o,{fz:"md",children:"Success! Your request will be processed in the background."})]})}),$=()=>t(Z,{children:[e(xe,{visible:w,overlayBlur:2}),h.hasMultiple?t(j,{mb:"lg",children:[h.hasDates&&t(Z,{children:[t(o,{fz:"md",mb:5,fw:500,children:["This is one event in a series. What would you like to ",te,"?"]}),e(Oe.Group,{value:T,onChange:R,children:t(F,{mt:"xs",gap:"xs",direction:"column",children:[e(Oe,{value:"one",label:"Just this one"}),e(Oe,{value:"all",label:"The entire series"})]})})]}),(T=="all"&&h.hasTeams||T=="one"&&h.hasTeamsOnThisDate)&&t(Z,{children:[t(o,{fz:"md",mt:"lg",mb:5,fw:500,children:["Which teams does this ",T=="all"?"series":"event"," ",te=="cancel"?"cancellation":"deletion"," apply to?"]}),e(Oe.Group,{value:J,onChange:N,children:t(F,{mt:"xs",gap:"xs",direction:"column",children:[e(Oe,{value:"all",label:"All teams"}),e(Oe,{value:"select",label:"Select teams"})]})}),J=="select"?T=="all"?e(B,{mt:"sm",children:h.teams.map((V,ue)=>e(We,{checked:W[V.teamid],onChange:()=>C(ee=>({...ee,[V.teamid]:!ee[V.teamid]})),children:V.teamname},ue))}):e(B,{mt:"sm",children:h.teamsOnThisDate.map((V,ue)=>e(We,{checked:W[V.teamid],onChange:()=>C(ee=>({...ee,[V.teamid]:!ee[V.teamid]})),children:V.teamname},ue))}):""]})]}):"",t(j,{children:[e(o,{fz:"md",mb:5,fw:500,children:"Who should the system notify about this?"}),e(be.Group,{value:I,onChange:L,children:t(F,{mt:"xs",gap:"xs",direction:"column",children:[e(be,{value:"teamstaff",label:"Coaches/Assistants"}),e(be,{value:"students",label:"Students"}),e(be,{value:"parents",label:"Parents"})]})})]}),O&&e(j,{mt:"md",children:e(o,{mb:5,fz:12,c:"red",sx:{wordBreak:"break-all"},children:O})}),e(F,{mt:"md",justify:"end",children:e(D,{onClick:y,loading:b,color:"red",radius:"xl",children:e(o,{tt:"capitalize",children:"Submit"})})})]});return e(re,{opened:u,onClose:k,title:n==1?"Confirm cancel":"Confirm delete",size:"lg",styles:{header:{borderBottom:"0.0625rem solid #dee2e6"},title:{fontWeight:600}},children:e(j,{mt:"xs",p:"xs",pos:"relative",children:z&&!d?Q():$()})})}const ut={role:null,child:null},It=Te(n=>({...ut,setState:a=>n(a==-1?ut:a),reset:()=>n(ut)}));function sa({opened:n,close:a,submitted:u}){const c={title:"",days:[],teams:[],start:"",end:"",location:"",details:""},[s,l]=r.useState({...c}),[S,w]=r.useState([]),[f,i]=r.useState([]),z=r.useRef(),d=r.useRef(),[b,p,m,h,E]=ae(),T=C=>{const I=s.days.some(L=>He(C).isSame(L,"date"));l(I?L=>({...L,days:L.days.filter(O=>!He(O).isSame(C,"date"))}):L=>({...L,days:[...L.days,C]}))},R=C=>{const I=JSON.parse(C);s.teams.some(O=>I.id==O.id)||l(O=>({...O,teams:[...O.teams,I]}))},J=C=>{l(I=>({...I,teams:I.teams.filter(L=>L.id!=C)}))};r.useEffect(()=>{w(s.teams.map((C,I)=>e(ge,{pr:0,mr:"xs",mb:"xs",variant:"filled",color:"gray.2",size:"lg",radius:"xl",children:t(F,{gap:4,children:[e(o,{sx:{textTransform:"none",fontWeight:"400",color:"#000"},children:C.name}),e(Be,{onMouseDown:()=>J(C.id),variant:"transparent",size:22,iconSize:14,tabIndex:-1})]})},I)))},[s.teams]);const N={title:[C=>C.length?null:"Title is required. "],teams:[C=>C.length?null:"Teams are required. "],start:[C=>C.length?null:"Start time is required. "],end:[C=>C.length?null:"End time is required. "],days:[C=>C.length?null:"Dates are required. "],location:[C=>C.length?null:"Location is required. "]},W=()=>{let C={hasErrors:!1};for(let L in N)for(let[O,g]of N[L].entries()){let q=g(s[L]);if(q){C.hasErrors=!0;let A=[];Object.hasOwn(C,L)&&(A=C[L]),A.push(q),C={...C,[L]:A}}}if(i(C),C.hasErrors)return;let I=JSON.parse(JSON.stringify({...s}));I.days=I.days.map(L=>He(L).format("YYYY-MM-DD")),h({method:"POST",body:{methodname:"local_teamup-post_schedule",args:I}})};return r.useEffect(()=>{!p&&b&&(l({...c}),u()),p&&i({hasErrors:!1,submit:"There was an error submitting. "+b.exception.message})},[b]),e(re,{opened:n,onClose:a,title:"Create schedule",size:"xl",styles:{header:{borderBottom:"0.0625rem solid #dee2e6"},title:{fontWeight:600}},children:t(j,{pt:"lg",px:"lg",children:[t(H,{gutter:"lg",children:[e(H.Col,{span:12,children:e(Re,{label:"Title",error:f.title,value:s.title,placeholder:"14's Footy Training",onChange:C=>l(I=>({...I,title:C.target.value}))})}),t(H.Col,{span:12,children:[e(o,{fz:"sm",mb:"5px",weight:500,color:"#212529",children:"Select teams"}),e(F,{children:S}),f.teams?e(o,{mb:5,fz:12,c:"red",sx:{wordBreak:"break-all"},children:f.teams}):"",e(Ge,{radius:"sm",px:"md",sx:{border:"0.0625rem solid #dee2e6"},children:e(je,{category:n?-1:!1,callback:R,showCheckbox:!1})})]}),e(H.Col,{xs:12,sm:6,children:e(Ct,{label:"Start time",value:s.start,error:f.start,onChange:C=>l(I=>({...I,start:C.target.value})),ref:z,rightSection:e(mt,{onClick:()=>z.current.showPicker(),children:e(zt,{size:"1rem",stroke:1.5})})})}),e(H.Col,{xs:12,sm:6,children:e(Ct,{label:"End time",value:s.end,error:f.end,onChange:C=>l(I=>({...I,end:C.target.value})),ref:d,rightSection:e(mt,{onClick:()=>d.current.showPicker(),children:e(zt,{size:"1rem",stroke:1.5})})})}),t(H.Col,{span:12,children:[e(o,{fz:"sm",mb:"5px",weight:500,color:"#212529",children:"Occurs on these dates"}),f.days?e(o,{mb:5,fz:12,c:"red",sx:{wordBreak:"break-all"},children:f.days}):"",e(un,{getDayProps:C=>({selected:s.days.some(I=>He(C).isSame(I,"date")),onClick:()=>T(C)})})]}),e(H.Col,{span:12,children:e(Re,{label:"Location",value:s.location,error:f.location,onChange:C=>l(I=>({...I,location:C.target.value}))})}),e(H.Col,{span:12,children:e(St,{label:"Description",value:s.details,onChange:C=>l(I=>({...I,details:C.target.value}))})})]}),f.hasErrors?e(o,{mt:"xs",c:"red",sx:{wordBreak:"break-all"},children:"Correct form errors and try again."}):"",f.submit?e(o,{mt:"xs",c:"red",sx:{wordBreak:"break-all"},children:f.submit}):"",e(F,{pt:"sm",justify:"end",children:e(D,{onClick:W,loading:m,disabled:f.length,type:"submit",radius:"xl",children:"Submit"})})]})})}function ra(){const n=It(v=>v.setState),a=It(),u=r.createRef(),[c,s]=r.useState(""),[l,S]=r.useState([]),[w,f]=r.useState({start:0,end:0}),[i,z]=r.useState(null),[d,b]=r.useState("dayGridMonth"),[p,m]=r.useState(null),[h,E,T,R]=ae(),[J,N]=le(!1),[W,C]=r.useState(0),[I,L]=le(!1),[O,g]=r.useState([]),[q,A]=r.useState(null),[te,y]=r.useState(!1),k=G().roles.includes("staff")||G().roles.includes("manager"),Y=G().roles.includes("coach")||G().roles.includes("assistant"),Q=G().roles.includes("student"),$=G().roles.includes("parent"),V=k+Y+Q+$>1,ue=V||i=="parent"&&O.length;r.useEffect(()=>{let v="";a.role?v=a.role:V?v=Y?"teamstaff":Q?"teamstudent":$?"parent":k?"browse":null:v=k&&"browse"||Y&&"teamstaff"||Q&&"teamstudent"||$&&"parent",z(v),v!="parent"&&ze(v,null,!0)},[]),r.useEffect(()=>{async function v(){if($){const x=await ye({query:{methodname:"local_teamup-get_users_children"}});g(x.data.map(M=>({value:M.un,title:M.fn+" "+M.ln,avatar:"/local/teamup/avatar.php?username="+M.un}))),a.child&&x.data.filter(M=>M.un==a.child).length?A(a.child):x.data.length==1&&A(x.data[0].un)}}v()},[]),r.useEffect(()=>{i=="parent"&&q&&!h&&ze(i,q,!0)},[i,q]);const ee=(v,x="")=>{const M=u.current.getApi();let _=!1,K=i,ne=q;v=="role"&&(_=!0,K=x),v=="child"&&(_=!0,ne=x),v=="prev"&&M.prev(),v=="next"&&M.next(),v=="today"&&M.today(),v=="month"&&M.changeView("dayGridMonth"),v=="week"&&M.changeView("timeGridWeek"),v=="day"&&M.changeView("timeGridDay"),v=="list"&&M.changeView("listWeek"),b(M.view.type),_&&S([]),ze(K,ne,_)},Ce=v=>{z(v),ee("role",v),n({role:v}),v!="parent"&&y(!1)},Xe=v=>{A(v),ee("child",v),n({child:v}),y(!1)},_e=v=>{m({id:v.event.id,title:v.event.title,startReadable:v.event.extendedProps.startReadable,endReadable:v.event.extendedProps.endReadable,teams:v.event.extendedProps.teams,location:v.event.extendedProps.location,details:v.event.extendedProps.details,cancelled:v.event.extendedProps.cancelled})},Ae=()=>{m(null)},Ie=()=>{C(1),N.open()},Fe=()=>{C(2),N.open()},Ze=()=>{N.close(),Ae(),ze(i,q,!0)},et=()=>{L.close(),ze(i,q,!0)},ze=(v,x,M)=>{if(!v)return;const _=u.current.getApi();s(_.view.title);const K=_.view.currentStart.valueOf(),ne=_.view.currentEnd.valueOf();if(M||K<w.start||ne>w.end){const rt=M||!w.start?K:Math.min(K,w.start),Ht=M?ne:Math.max(ne,w.end);f({start:rt,end:Ht}),R({query:{methodname:"local_teamup-get_events",start:K,end:ne,role:v,child:x}})}};r.useEffect(()=>{if(h&&!E&&h.data.length){const v=new Set(l.map(M=>M.id)),x=[...l,...h.data.filter(M=>!v.has(M.id))];S(x),window.dispatchEvent(new Event("resize"))}},[h]);const tt=v=>t(F,{gap:3,align:"center",children:[e(o,{fz:"xs",fw:600,td:v.event.extendedProps.cancelled?"line-through":"",children:v.timeText}),e(o,{fz:"xs",td:v.event.extendedProps.cancelled?"line-through":"",children:v.event.title})]}),Ee=({value:v,icon:x,title1:M,title2:_})=>{const K=i==v,{classes:ne}=qe({active:K});return e(Se,{onClick:()=>Ce(v),children:t(F,{className:ne.role,justify:"center",align:"center",direction:"column",wrap:"wrap",children:[e(Je,{hidden:!0,width:36,src:x,mb:5}),e(o,{size:"md",weight:500,children:e(oe,{children:M})}),e("div",{className:"page-pretitle",children:_})]})})},nt=({value:v,avatar:x,title:M})=>{const _=q==v,{classes:K}=qe({active:_});return e(Se,{onClick:()=>Xe(v),children:t(F,{className:K.child,justify:"center",align:"center",direction:"column",wrap:"wrap",children:[e(Je,{radius:"xl",width:36,src:x,mb:5}),e(o,{size:"md",weight:500,children:e(oe,{children:M})})]})})},at=()=>e(P.Section,{p:0,sx:{backgroundColor:"#f8f9fa"},children:e(Se,{mih:"2.5rem",px:"md",onClick:()=>y(!0),sx:{width:"100%"},children:t(F,{gap:"sm",align:"center",children:[e(o,{fz:"sm",fw:600,children:"Viewing as:"}),e(o,{fz:"sm",weight:500,tt:"capitalize",children:i=="teamstaff"?t(B,{spacing:4,children:["Coach ",e(Tt,{size:6})," Assistant"]}):i}),i=="parent"&&O.length>1&&t(Z,{children:[e(kt,{size:18}),e(Je,{radius:"xl",width:30,src:O.find(v=>v.value==q).avatar}),e(o,{fz:"sm",weight:500,children:O.find(v=>v.value==q).title})]}),e(De,{color:"#3a85df",size:15})]})})}),st=()=>t(Z,{children:[V&&t(P.Section,{p:"md",sx:{backgroundColor:"#f8f9fa"},children:[e(o,{fw:500,ta:"center",mb:"lg",children:"Who are you viewing as?"}),t(F,{gap:"sm",justify:"center",wrap:"wrap",children:[Y&&e(Ee,{value:"teamstaff",icon:ea,title1:t(B,{spacing:4,children:["Coach ",e(Tt,{size:6})," Assistant"]}),title2:"Teams you lead"}),Q&&e(Ee,{value:"teamstudent",icon:ta,title1:"Student",title2:"Teams you're a member of"}),$&&e(Ee,{value:"parent",icon:na,title1:"Parent",title2:"Your childrens teams"}),k&&e(Ee,{value:"browse",icon:aa,title1:"Browse",title2:"All activities"})]})]}),i=="parent"&&O.length>1&&t(P.Section,{p:"md",sx:{backgroundColor:"#f8f9fa"},children:[e(o,{fw:500,ta:"center",mb:"lg",children:"Select one of your children"}),e(F,{gap:"sm",justify:"center",wrap:"wrap",children:O.map((v,x)=>e(nt,{value:v.value,avatar:v.avatar,title:v.title},x))})]}),i=="parent"&&!O.length&&e(P.Section,{p:"md",sx:{backgroundColor:"#f8f9fa"},children:e(o,{fw:500,ta:"center",mb:"lg",children:"Loading child information..."})})]}),qe=xn((v,{active:x})=>({role:{padding:v.spacing.md,backgroundColor:x?"#E1F2FF":"#fff",borderRadius:v.radius.md,color:v.black,boxShadow:v.shadows.sm,transition:"box-shadow 150ms ease, transform 100ms ease",textAlign:"center",width:"200px","&:hover":{boxShadow:v.shadows.md,transform:"scale(1.05)"}},child:{padding:v.spacing.md,backgroundColor:x?"#E1F2FF":"#fff",borderRadius:v.radius.md,color:v.black,boxShadow:v.shadows.sm,transition:"box-shadow 150ms ease, transform 100ms ease",textAlign:"center",width:"200px","&:hover":{boxShadow:v.shadows.md,transform:"scale(1.05)"}}}));return t(Z,{children:[t(P,{withBorder:!0,radius:"sm",mb:"lg",pb:0,sx:{borderBottomRightRadius:0,borderBottomLeftRadius:0,overflow:"visible"},children:[e(P.Section,{p:"md",withBorder:!0,children:t(B,{position:"apart",children:[e(o,{size:"md",weight:500,children:"Schedule"}),G().roles.includes("manager")&&e(D,{onClick:L.open,radius:"lg",compact:!0,variant:"light",leftIcon:e(mn,{size:12}),children:"Add events"})]})}),ue?te||!i||i=="parent"&&!q?st():at():null,e(P.Section,{withBorder:ue,hidden:!i||$&&!O.length,children:t(j,{pos:"relative",mih:250,children:[e(xe,{visible:T,overlayBlur:2}),t(B,{p:"xs",position:"apart",sx:{borderBottom:"0.0625rem solid #dee2e6"},children:[t(B,{children:[t(D.Group,{children:[e(D,{onClick:()=>ee("prev"),variant:"light",compact:!0,children:e(fn,{size:19})}),e(D,{onClick:()=>ee("next"),variant:"light",compact:!0,children:e(kt,{size:19})})]}),e(D,{onClick:()=>ee("today"),variant:"light",compact:!0,children:"today"})]}),e(o,{weight:600,size:"1.15rem",children:c}),t(D.Group,{children:[e(D,{onClick:()=>ee("month"),variant:d=="dayGridMonth"?"filled":"light",compact:!0,className:d=="dayGridMonth"?"bg-tablr-blue":"bg-tablr-blue-light",children:"month"}),e(D,{onClick:()=>ee("week"),variant:d=="timeGridWeek"?"filled":"light",compact:!0,className:d=="timeGridWeek"?"bg-tablr-blue":"bg-tablr-blue-light",children:"week"}),e(D,{onClick:()=>ee("day"),variant:d=="timeGridDay"?"filled":"light",compact:!0,className:d=="timeGridDay"?"bg-tablr-blue":"bg-tablr-blue-light",children:"day"}),e(D,{onClick:()=>ee("list"),variant:d=="listWeek"?"filled":"light",compact:!0,className:d=="listWeek"?"bg-tablr-blue":"bg-tablr-blue-light",children:"list"})]})]}),e(pn,{ref:u,timeZone:"UTC",plugins:[gn,bn,Sn,vn],headerToolbar:null,initialView:"dayGridMonth",nowIndicator:!0,dayMaxEventRows:!0,dayMaxEvents:!0,eventContent:tt,eventClick:_e,eventMaxStack:d=="timeGridWeek"?2:5,events:l})]})})]}),e(xt,{opened:!!p,eventData:p,showOptions:!0,viewRole:i,close:Ae,onCancel:Ie,onDelete:Fe,isCancelModalOpen:J}),e(yt,{deleteOrCancel:W,opened:J,eventid:p?p.id:0,close:N.close,submitted:Ze}),G().roles.includes("manager")&&e(sa,{opened:I,close:L.close,submitted:et})]})}function la(){const[n,a,u,c]=ae(),[s,l]=r.useState([]),[S,w]=le(!1),[f,i]=le(!1),[z,d]=r.useState({}),[b,p]=r.useState(0);r.useEffect(()=>{c({query:{methodname:"local_teamup-get_user_events_today"}})},[]),r.useEffect(()=>{n&&!a&&l(n.data)},[n]);const m=R=>{d(R),w.open()},h=()=>{p(1),i.open()},E=()=>{p(2),i.open()},T=()=>{i.close(),w.close()};return t(P,{withBorder:!0,radius:"sm",pb:"md",children:[e(P.Section,{withBorder:!0,p:"md",children:e(o,{size:"md",weight:500,children:"Your day"})}),e(P.Section,{pb:5,children:t(j,{pos:"relative",mih:40,children:[e(xe,{loaderProps:{size:"sm"},visible:u}),!s.length&&n&&e(o,{c:"dimmed",px:"md",py:"sm",fz:"sm",children:"No events on today"}),s.map((R,J)=>t(j,{sx:{borderBottom:J+1===s.length?"0 none":"0.0625rem solid #dee2e6"},children:[R.role=="parent"?e("div",{children:t(B,{spacing:"xs",px:"md",py:5,bg:"gray.1",children:[e(ie,{size:"sm",radius:"xl",src:"/local/teamup/avatar.php?username="+R.child.un}),t(o,{fz:"sm",children:[R.child.fn," ",R.child.ln]})]})}):null,e(jt,{horizontalSpacing:"lg",children:e("tbody",{children:R.events.map((N,W)=>e("tr",{children:e("td",{children:t(F,{gap:"xs",align:"center",children:[t(o,{fz:"sm",fw:600,td:N.cancelled?"line-through":"",children:[N.timestartReadable," - ",N.timeendReadable]}),e(Se,{children:e(o,{onClick:()=>m(N),c:"tablrblue",fz:"sm",td:N.cancelled?"line-through":"",children:N.title})})]})})},W))})})]},J)),!!s.length&&t(Z,{children:[e(xt,{opened:S,eventData:z,showOptions:!0,close:w.close,onCancel:h,onDelete:E,isCancelModalOpen:f}),e(yt,{deleteOrCancel:b,opened:f,eventid:z?z.id:0,close:i.close,submitted:T})]})]})})]})}function ia(){r.useEffect(()=>{document.title="Teams Dashboard"},[]);const n=G().user.un+","+G().user.fn+" "+G().user.ln;return t(r.Fragment,{children:[e($e,{}),e("div",{className:"page-wrapper",children:e("div",{children:e(ce,{size:"xl",mt:50,mb:"xl",children:t(H,{grow:!0,children:[e(H.Col,{lg:9,children:e(ra,{})}),e(H.Col,{lg:3,children:e(j,{children:t(H,{grow:!0,children:[e(H.Col,{xs:12,sm:6,lg:12,children:e(la,{})}),e(H.Col,{xs:12,sm:6,lg:12,children:e($n,{})}),e(H.Col,{xs:12,sm:6,lg:12,children:e(Xn,{})}),G().roles.includes("student")&&e(H.Col,{xs:12,sm:6,lg:12,children:e(Kn,{value:n})}),G().roles.includes("manager")&&e(H.Col,{xs:12,sm:6,lg:12,children:e(Zn,{})})]})})})]})})})}),e(Ke,{})]})}function oa(){return e(r.Fragment,{children:e("div",{className:"page-header",children:e(ce,{size:"xl",p:0,my:"md",children:t(Ne,{fz:"sm",mb:"sm",children:[e(de,{to:"/",children:e(o,{color:"blue",children:"Dashboard"})}),e(de,{to:location.pathname,children:e(o,{color:"gray.6",children:"Message"})})]})})})})}function ca({data:n,opened:a,close:u}){const[c,s]=r.useState({});r.useEffect(()=>{s({subject:n.subject,message:n.bodyplain})},[n]);const[l,S]=r.useState([]),[w,f,i,z]=ae(),d={subject:[m=>m.length?null:"Title is required. "],message:[m=>m.length?null:"Message is required. "]},b=()=>{let m={hasErrors:!1};for(let E in d)for(let[T,R]of d[E].entries()){let J=R(c[E]);if(J){m.hasErrors=!0;let N=[];Object.hasOwn(m,E)&&(N=m[E]),N.push(J),m={...m,[E]:N}}}if(S(m),m.hasErrors)return;let h=JSON.parse(JSON.stringify({...c}));h.id=n.id,z({method:"POST",body:{methodname:"local_teamup-edit_message",args:h}})},p=Qe();return r.useEffect(()=>{if(!f&&w&&(p(0),u()),f){let m="There was an error submitting. "+w.exception!==void 0?w.exception.message:"";S({hasErrors:!1,submit:m})}},[w]),e(re,{title:"Edit message",opened:a,onClose:u,size:"xl",styles:{header:{borderBottom:"0.0625rem solid #dee2e6"},title:{fontWeight:600}},children:t(j,{pt:"lg",px:"lg",children:[t(H,{gutter:"lg",children:[e(H.Col,{span:12,children:e(Re,{label:"Subject",error:l.subject,value:c.subject,onChange:m=>s(h=>({...h,subject:m.target.value}))})}),e(H.Col,{span:12,children:e(St,{label:"Message",autosize:!0,minRows:4,maxRows:10,error:l.message,value:c.message,onChange:m=>s(h=>({...h,message:m.target.value}))})})]}),l.hasErrors?e(o,{mt:"xs",c:"red",sx:{wordBreak:"break-all"},children:"Correct form errors and try again."}):"",l.submit?e(o,{mt:"xs",c:"red",sx:{wordBreak:"break-all"},children:l.submit}):"",e(F,{pt:"sm",justify:"end",children:e(D,{onClick:b,loading:i,disabled:l.length,type:"submit",radius:"xl",children:"Submit"})})]})})}function da({recipients:n,opened:a,close:u}){const c=s=>e(ge,{variant:"filled",pl:0,color:"gray.2",size:"lg",radius:"xl",leftSection:e(ie,{alt:s.fn+" "+s.ln,size:24,mr:5,src:"/local/teamup/avatar.php?username="+s.un,radius:"xl",children:e(fe,{size:14})}),children:e(F,{gap:4,children:e(o,{sx:{textTransform:"none",fontWeight:"400",color:"#000"},children:s.fn+" "+s.ln})})},s.un);return e(re,{opened:a,onClose:u,title:"Recipients",size:"xl",styles:{header:{borderBottom:"0.0625rem solid #dee2e6"},title:{fontWeight:600}},children:e(j,{pt:"md",children:e(B,{spacing:"xs",children:n.map(s=>c(s))})})})}function ha(){let{id:n}=Le();const[a,u,c,s]=ae(),[l,S]=r.useState(null),[w,f]=le(!1),[i,z]=le(!1),[d,b,p,m]=ae();r.useEffect(()=>{document.title="Messages",n&&s({query:{methodname:"local_teamup-get_message",id:n}})},[n]),r.useEffect(()=>{a&&!u&&S(a.data)},[a]);const h=R=>{yn.openConfirmModal({title:"Delete message",centered:!0,children:e(o,{size:"sm",children:"Are you sure you want to delete this message?"}),labels:{confirm:"Delete message",cancel:"No don't delete it"},confirmProps:{color:"red",className:"bg-mantine-red"},onConfirm:()=>E(R)})},E=R=>{m({method:"POST",body:{methodname:"local_teamup-delete_message",args:{id:R}}})},T=Qe();return r.useEffect(()=>{d&&!b&&T("/")},[d]),t(r.Fragment,{children:[e($e,{}),e("div",{className:"page-wrapper",children:a?u||!l?e(ce,{size:"xl",children:e(oe,{h:300,children:e(o,{fw:600,fz:"lg",children:"Failed to load message. It might have been deleted."})})}):t(Z,{children:[e(ce,{size:"xl",children:e(oa,{})}),e(ce,{size:"xl",my:"md",children:e(P,{withBorder:!0,radius:"sm",mb:"lg",sx:{overflow:"visible"},children:e(P.Section,{children:t(j,{className:"message",p:"sm",sx:{borderBottom:"0.0625rem solid #dee2e6"},children:[t(B,{position:"apart",align:"start",children:[t(B,{children:[e(ie,{size:"2.5rem",src:"/local/teamup/avatar.php?username="+l.un,alt:l.fn+" "+l.ln,radius:"xl"}),t("div",{children:[e(o,{fz:"md",children:l.fn+" "+l.ln}),e(o,{fz:"sm",color:"dimmed",children:l.postedAt})]})]}),l.isOwner||G().roles.includes("manager")?t(U,{shadow:"md",width:200,position:"bottom",children:[e(U.Target,{children:e(D,{loading:p,compact:!0,variant:"light",radius:"xl",rightIcon:p?null:e(vt,{size:16}),children:p?"Deleting":"Options"})}),t(U.Dropdown,{children:[e(U.Item,{onMouseDown:()=>z.open(),icon:e(bt,{size:14}),children:"Recipients"}),e(U.Item,{onMouseDown:()=>f.open(),icon:e(De,{size:14}),children:"Edit"}),e(U.Item,{color:"red",icon:e(At,{size:14}),onMouseDown:()=>h(l.id),children:"Delete"})]})]}):null]}),e(o,{mt:"sm",fz:"md",fw:500,children:l.subject}),e(o,{mt:"sm",fz:"md",children:e("div",{dangerouslySetInnerHTML:{__html:l.body}})})]})})})}),e(ca,{data:l,opened:w,close:f.close}),e(da,{recipients:l.recipients,opened:i,close:z.close})]}):e(oe,{h:200,mx:"auto",children:e(pe,{variant:"dots"})})}),e(Ke,{})]})}function ua({title:n,eventMToggle:a,cEventMToggle:u}){return e(r.Fragment,{children:e("div",{className:"page-header",children:t(ce,{size:"xl",my:"md",p:0,children:[t(Ne,{fz:"sm",mb:"sm",children:[e(de,{to:"/",children:e(o,{color:"blue",children:"Dashboard"})}),e(de,{to:location.pathname,children:e(o,{color:"gray.6",children:"Attendance"})})]}),t(B,{spacing:"sm",children:[e("h2",{className:"page-title",children:n}),t(U,{shadow:"md",width:200,position:"bottom-start",children:[e(U.Target,{children:e(mt,{size:"xs",radius:"xl",variant:"filled",color:"blue",children:e(vt,{size:16})})}),t(U.Dropdown,{children:[e(U.Item,{icon:e(wn,{size:14}),onMouseDown:a.open,children:"View event details"}),e(U.Item,{color:"red",icon:e(_t,{size:14}),onMouseDown:u.open,children:"Cancel event"})]})]})]})]})})})}function ma(){let{eventid:n}=Le();const[a,u,c,s]=ae(),[l,S]=r.useState({}),[w,f]=r.useState([]),[i,z]=r.useState(0),[d,b]=new r.useState([]),[p,m,h,E]=ae(),[T,R]=r.useState({}),[J,N]=r.useState({}),[W,C]=r.useState("present"),[I,L]=r.useState(""),[O,g,q,A]=ae(),[te,y]=le(!1),[k,Y]=le(!1),[Q,$]=le(!1),[V,ue]=r.useState(!1),[ee,Ce]=r.useState(""),[Xe,_e]=r.useState(0),[Ae,Ie]=r.useState(!1),{start:Fe,clear:Ze}=Ue(()=>Ie(!1),1e3);r.useEffect(()=>{document.title="Attendance",s({query:{methodname:"local_teamup-get_event_info",id:n}}),navigator.geolocation&&navigator.geolocation.getCurrentPosition(x=>{L(x.coords.latitude+","+x.coords.longitude)})},[]),r.useEffect(()=>{if(a&&!u){const x={...a.data.event,teams:a.data.teams};S(x),a.data.teams&&(f(a.data.teams),z(a.data.teams[0].teamid))}},[a]),r.useEffect(()=>{n&&i&&E({query:{methodname:"local_teamup-get_attendance_students",eventid:n,teamid:i}})},[n,i]),r.useEffect(()=>{p&&!m&&(b(p.data.students),R(p.data.roll))},[p]);const et=x=>{const M=T[x]?T[x]:0,_=W=="absent"?(M+3-1)%3:(M+1)%3;N(K=>({...K,[x]:!0})),A({method:"POST",body:{methodname:"local_teamup-submit_attendance",args:{eventid:n,username:x,value:_,geolocation:I,method:"single"}}})};r.useEffect(()=>{O&&!g&&O.data.operation=="single"&&(R(x=>({...x,[O.data.username]:O.data.value})),N(x=>({...x,[O.data.username]:!1})))},[O]);const ze=()=>{const x=W=="absent"?2:1,M=d.reduce((_,K)=>Object.assign(_,{[K.un]:!0}),{});N({...M}),A({method:"POST",body:{methodname:"local_teamup-submit_attendance_multi",args:{eventid:n,usernames:d.map(_=>_.un),value:x,geolocation:I,method:"multi"}}})};r.useEffect(()=>{if(O&&!g&&O.data.operation=="multi"){const x=O.data.usernames.reduce((_,K)=>Object.assign(_,{[K]:O.data.value}),{});R(_=>({..._,...x}));const M=d.reduce((_,K)=>Object.assign(_,{[K.un]:!1}),{});N(_=>({..._,...M}))}},[O]);const tt=()=>{const x=W=="absent"?2:1,M=Object.keys(T).filter(function(ne){return T[ne]!=0}),_=d.map(ne=>ne.un).filter(ne=>!M.includes(ne)),K=_.reduce((ne,rt)=>Object.assign(ne,{[rt]:!0}),{});N({...K}),A({method:"POST",body:{methodname:"local_teamup-submit_attendance_multi",args:{eventid:n,usernames:_,value:x,geolocation:I,method:"multi"}}})},Ee=x=>{if(V)return;const M=x.split(",");M.length==2&&(ue(!0),Ze(),Ce({username:M[0],fullname:M[1],avatar:"/local/teamup/avatar.php?username="+M[0]}),N(_=>({..._,[M[0]]:!0})),A({method:"POST",body:{methodname:"local_teamup-submit_attendance",args:{eventid:n,username:M[0],value:1,geolocation:I,method:"qr"}}}))};r.useEffect(()=>{O&&!g&&O.data.operation=="qr"&&(R(x=>({...x,[O.data.username]:O.data.value})),N(x=>({...x,[O.data.username]:!1})),ue(!1),_e(1),Ie(!0),Fe())},[O]),r.useEffect(()=>{g&&(console.log("There was an error submitting. "+O.exception!==void 0?O.exception.message:""),ue(!1),_e(0),Ie(!0),Fe())},[g]);const nt=x=>e(Ye,{mounted:Ae,transition:"fade",duration:500,timingFunction:"ease",children:M=>e(oe,{bg:x==1?"rgba(99, 205, 119, 0.2)":"rgba(231, 134, 134, 0.2)",pos:"absolute",sx:{top:0,width:"100%",height:"500px"},style:{...M},children:e(Ge,{bg:"transparent",shadow:"sm",p:0,radius:"xs",sx:{overflow:"hidden"},children:x==1?e(ke,{size:60,color:"green"}):e(lt,{size:60,color:"red"})})})}),at=(x,M)=>{const _=T[x.un]!==void 0?T[x.un]:0,K=J[x.un]!==void 0?J[x.un]:0,ne=M==d.length-1;return t(Se,{onClick:()=>et(x.un),pos:"relative",children:[e(xe,{visible:K,loaderProps:{size:"sm",variant:"dots"},overlayOpacity:.2,overlayColor:"#000"}),t(B,{px:"md",py:"sm",spacing:"xs",align:"center",sx:{borderBottom:ne?null:"0.0625rem solid #dee2e6",backgroundColor:_==1?"#D3F9D8":_==2?"#f8d7da":null,transition:"background 150ms ease"},children:[e(ie,{alt:x.fn+" "+x.ln,size:"md",src:"/local/teamup/avatar.php?username="+x.un,radius:"xl",children:e(fe,{size:14})}),e(o,{children:x.ln+", "+x.fn})]})]},M)},st=e(B,{position:"center",children:e(On,{checked:W=="present",onChange:x=>C(x.currentTarget.checked?"present":"absent"),color:"teal",size:"md",onLabel:e(ke,{size:"1rem",stroke:2.5,color:"white"}),offLabel:e(lt,{size:"1rem",stroke:2.5,color:"white"}),styles:{track:{borderColor:"#fa5252",backgroundColor:"#fa5252"}}})}),qe=e(Z,{children:e(j,{children:e(Cn,{in:Q,children:e(j,{p:"sm",bg:"#000",pos:"relative",h:500,children:t(j,{className:"qr-scanner",h:"100%",maw:500,mx:"auto",pos:"relative",sx:{borderRadius:"5px",overflow:"hidden"},children:[e(zn,{onDecode:x=>Ee(x),onError:x=>console.log(x==null?void 0:x.message),viewFinderBorder:0,containerStyle:{width:"100%",overflow:"hidden",position:"relative",padding:"0",height:"500px"},videoStyle:{width:"auto"}}),V?e(oe,{bg:"rgba(0,0,0,0.8)",pos:"absolute",sx:{top:0,width:"100%",height:"500px"},children:e(Ge,{shadow:"sm",p:0,pr:"sm",radius:"xs",sx:{overflow:"hidden"},children:e(oe,{children:t(B,{children:[e(ie,{alt:"test test",size:"lg",src:ee.avatar,radius:0}),e(o,{fz:"lg",fw:600,children:ee.fullname}),e(pe,{size:"sm",sx:{display:"block !important"}})]})})})}):nt(Xe)]})})})})}),v=e(Z,{children:t(P,{withBorder:!0,radius:"sm",mb:"lg",sx:{overflow:"hidden"},children:[e(P.Section,{inheritPadding:!0,withBorder:!0,py:"sm",children:e(B,{position:"apart",align:"center",children:e(o,{size:"lg",weight:500,children:"Roll marking"})})}),e(P.Section,{inheritPadding:!0,withBorder:!0,py:"sm",children:t(B,{position:"apart",children:[e(We.Group,{value:i,onChange:z,children:e(B,{position:"center",children:w.length>1?w.map((x,M)=>x.cancelled==0&&e(We,{value:x.teamid,variant:"light",children:x.teamname},M)):w.length==1?e(ge,{color:"dark",size:"lg",tt:"none",fw:400,value:w[0].teamid,variant:"light",children:w[0].teamname}):null})}),e(D,{onClick:$.toggle,compact:!0,radius:"xl",leftIcon:Q?e(lt,{size:18}):e(kn,{size:18}),children:"QR scanner"})]})}),e(P.Section,{children:Q?qe:null}),e(P.Section,{children:t(j,{pos:"relative",mih:"3.25rem",children:[e(xe,{visible:c||h}),e(gt,{spacing:0,children:d.map((x,M)=>at(x,M))})]})}),e(P.Section,{inheritPadding:!0,withBorder:!0,py:"md",children:t(B,{position:"apart",children:[t(F,{gap:"sm",children:[st,t(D,{color:W=="absent"?"red":"teal",onClick:tt,variant:"filled",compact:!0,radius:"xl",leftIcon:e(Tn,{size:14}),children:["Remaining ",W]}),t(D,{color:W=="absent"?"red":"teal",onClick:ze,variant:"filled",compact:!0,radius:"xl",leftIcon:e(En,{size:14}),children:["All ",W]})]}),e(de,{to:"/team/"+i,children:e(D,{variant:"light",compact:!0,radius:"xl",leftIcon:e(Lt,{size:14}),children:"Open team"})})]})})]})});return t(r.Fragment,{children:[e($e,{}),t("div",{className:"page-wrapper",children:[e(ce,{size:"xl",children:e(ua,{title:l.title,cEventMToggle:Y,eventMToggle:y})}),a?t(ce,{size:"xl",mb:"xl",children:[v,Object.keys(l).length!==0?t(Z,{children:[e(xt,{opened:te,eventData:l,showOptions:!1,close:y.close}),e(yt,{deleteOrCancel:1,opened:k,eventid:l.id,close:Y.close,submitted:Y.close})]}):""]}):e(oe,{h:200,mx:"auto",children:e(pe,{variant:"dots"})})]}),e(Ke,{})]})}function fa(){const n=Mn([{path:"/",element:e(ia,{})},{path:"team",element:e(Mt,{}),children:[{path:":id",element:e(Mt,{})}]},{path:"messages/:id",element:e(ha,{})},{path:"attendance/:eventid",element:e(ma,{})}],{basename:"/local/teamup"});return e("div",{className:"page",children:e(In,{router:n})})}Rn.createRoot(document.getElementById("root")).render(e(Bn.StrictMode,{children:e(Pn,{withNormalizeCSS:!0,withGlobalStyles:!0,theme:{fontFamily:'"Inter var", -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif',headings:{fontFamily:'"Inter var", -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif',h1:{fontSize:"1.5rem"},h2:{fontSize:"1.25rem"},h3:{fontSize:"1.5rem"},h4:{fontSize:"0.875rem"},h5:{fontSize:"0.75rem"},h6:{fontSize:"0.625rem"}},colors:{tablrblue:["#e1f2ff","#b9d6f9","#8ebbf0","#64a0e7","#3a85df","#358ae8","#206cc5","#15549a","#0b3c70","#022446"],apprgreen:["#e9f8ed","#d4edda","#c9e8d1","#a7d8b3","#85c995","#63ba77","#4aa15d","#397d48","#295a33","#17361e"],white:["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"]},primaryColor:"tablrblue",primaryShade:6},children:e(Nn,{children:e(fa,{})})})}));
